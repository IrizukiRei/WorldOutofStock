<!doctype html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ä¸–ç•Œã€åœ¨åº«åˆ‡ã‚Œ - ä»Šã™ãéŠã¶ç‰ˆ</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 24px; background: #f8fafc; color: #0f172a; }
    .card { background: #fff; border: 1px solid #cbd5e1; border-radius: 12px; padding: 16px; margin-bottom: 16px; }
    h1,h2 { margin: 0 0 12px; }
    .row { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 10px; }
    input, select, button { padding: 8px 10px; border-radius: 8px; border: 1px solid #94a3b8; }
    button { cursor: pointer; background: #0ea5e9; color: white; border: none; }
    button.sub { background: #334155; }
    button:disabled { opacity: 0.5; cursor: not-allowed; }
    .mono { font-family: ui-monospace, Menlo, monospace; white-space: pre-wrap; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <h1>ä¸–ç•Œã€åœ¨åº«åˆ‡ã‚Œï¼ˆä»Šã™ãéŠã¶ç‰ˆï¼‰</h1>
  <p><strong>ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«å˜ä½“ã§å‹•ãã¾ã™ã€‚</strong> GitHubã‹ã‚‰ã“ã®1ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦é–‹ã‘ã°OKï¼ˆãƒãƒ¼ã‚¸ä¸è¦ï¼‰ã€‚</p>
  <p>æ“ä½œãŒé¢å€’ãªã‚‰ã€Œã‚µãƒ³ãƒ—ãƒ«ã§é–‹å§‹ã€ã§å³ãƒ—ãƒ¬ã‚¤ã§ãã¾ã™ã€‚</p>
  <div class="row">
    <button id="sampleStart" class="sub">ã‚µãƒ³ãƒ—ãƒ«ã§é–‹å§‹</button>
    <button id="resetAll" class="sub">æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã™</button>
  </div>

  <div id="elimination" class="card">
    <h2>1) æ¶ˆæ»…ã‚²ãƒ¼ãƒ ï¼ˆå¿…è¦5é …ç›®ï¼‰</h2>
    <p id="stageLabel"></p>
    <div class="row">
      <input id="aItem" placeholder="Aå›½ã®é …ç›®" />
      <input id="bItem" placeholder="Bå›½ã®é …ç›®" />
      <button id="addItems">ç™»éŒ²</button>
    </div>
    <p class="mono" id="elimLog"></p>
  </div>

  <div id="inheritance" class="card hidden">
    <h2>2) ä¸–è¥²ï¼ˆå›½å®¶æ¬ æâ†’ç©ºæœ­ï¼‰</h2>
    <div class="row">
      <label>Aå›½å¼±ç‚¹è‰²:
        <select id="aWeak"><option>R</option><option>B</option><option>Y</option></select>
      </label>
      <label>Bå›½å¼±ç‚¹è‰²:
        <select id="bWeak"><option>R</option><option>B</option><option>Y</option></select>
      </label>
      <button id="startMain">5ã‚¿ãƒ¼ãƒ³é–‹å§‹</button>
    </div>
    <p>R=ğŸŸ¥èª‡ã‚Š / B=ğŸŸ¦ä¿¡é ¼ / Y=ğŸŸ¨æš‡</p>
  </div>

  <div id="mainGame" class="card hidden">
    <h2>3) 5ã‚¿ãƒ¼ãƒ³æœ¬ç·¨</h2>
    <p id="turnLabel"></p>
    <div class="row">
      <label>Aå›½ã‚«ãƒ¼ãƒ‰ <select id="aCard"><option>R</option><option>B</option><option>Y</option></select></label>
      <label>AçŸ­æ–‡ <input id="aText" placeholder="çŸ­æ–‡" /></label>
    </div>
    <div class="row">
      <label>Bå›½ã‚«ãƒ¼ãƒ‰ <select id="bCard"><option>R</option><option>B</option><option>Y</option></select></label>
      <label>BçŸ­æ–‡ <input id="bText" placeholder="çŸ­æ–‡" /></label>
    </div>
    <div class="row">
      <button id="playTurn">ã“ã®ã‚¿ãƒ¼ãƒ³ã‚’å®Ÿè¡Œ</button>
    </div>
    <p class="mono" id="turnLog"></p>
    <p class="mono" id="score"></p>
  </div>

  <script>
const stages = ["â‘ äººé¡", "â‘¡æ—¥æœ¬", "â‘¢äº¬éƒ½", "â‘£å®¶", "â‘¤ã‹ã°ã‚“"];
const colors = { R: "ğŸŸ¥èª‡ã‚Š", B: "ğŸŸ¦ä¿¡é ¼", Y: "ğŸŸ¨æš‡" };
const nextColor = { R: "B", B: "Y", Y: "R" };

const sampleA = ["ç©ºæ°—", "é›»æ°—", "é´¨å·", "å†·è”µåº«", "éµ"];
const sampleB = ["æ°´", "äº¤é€š", "å¯º", "å¸ƒå›£", "è²¡å¸ƒ"];

let state;

const $ = (id) => document.getElementById(id);

function initState() {
  state = {
    stageIdx: 0,
    seen: new Set(),
    aItems: [],
    bItems: [],
    weak: { A: "R", B: "B" },
    turn: 1,
    scores: { R: 0, B: 0, Y: 0 },
    past: { A: [], B: [] },
    twistTurn4: false,
    tossed: false,
    finished: false,
  };

  $("aItem").value = "";
  $("bItem").value = "";
  $("aText").value = "";
  $("bText").value = "";
  $("elimLog").textContent = "";
  $("turnLog").textContent = "";
  $("playTurn").disabled = false;
  $("elimination").classList.remove("hidden");
  $("inheritance").classList.add("hidden");
  $("mainGame").classList.add("hidden");
  renderElimination();
}

function renderElimination() {
  $("stageLabel").textContent = `ç¾åœ¨: ${stages[state.stageIdx]}`;
  $("elimLog").textContent = `Aå›½: ${state.aItems.join(", ")}\nBå›½: ${state.bItems.join(", ")}`;
}

function renderTurn() {
  if (state.finished) {
    $("turnLabel").textContent = `ã‚²ãƒ¼ãƒ çµ‚äº†: ${endMessage()}`;
  } else {
    $("turnLabel").textContent = `Turn ${state.turn}/5 ${state.turn <= 3 ? "(å†…æ”¿)" : "(å¤–äº¤)"}`;
  }
  $("score").textContent = `åœ¨åº«: ${colors.R}=${state.scores.R} / ${colors.B}=${state.scores.B} / ${colors.Y}=${state.scores.Y}`;
}

function normalizeCard(card, text) {
  return text.length > 12 ? "Y" : card;
}

function addScore(color) {
  if (color === state.weak.A || color === state.weak.B) return `${colors[color]}ã¯ç©ºæœ­ã§+0`;
  state.scores[color] += 1;
  return `${colors[color]} +1`;
}

function endMessage() {
  const entries = Object.entries(state.scores).sort((a, b) => b[1] - a[1]);
  if (entries[0][1] === entries[1][1]) return "ç™½ç´™åˆæ„ã‚¨ãƒ³ãƒ‰";
  return entries[0][0] === "R" ? "é–‹æˆ¦ã‚¨ãƒ³ãƒ‰" : entries[0][0] === "B" ? "åŒç›Ÿã‚¨ãƒ³ãƒ‰" : "å†…éƒ¨å´©å£Šã‚¨ãƒ³ãƒ‰";
}

$("addItems").onclick = () => {
  const a = $("aItem").value.trim();
  const b = $("bItem").value.trim();
  if (!a || !b) return alert("ä¸¡æ–¹å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
  if (state.seen.has(a) || state.seen.has(b)) return alert("é‡è¤‡èªã¯ç¦æ­¢ã§ã™ã€‚");

  state.seen.add(a);
  state.seen.add(b);
  state.aItems.push(a);
  state.bItems.push(b);
  $("aItem").value = "";
  $("bItem").value = "";
  state.stageIdx += 1;

  if (state.stageIdx >= 5) {
    $("elimination").classList.add("hidden");
    $("inheritance").classList.remove("hidden");
  } else {
    renderElimination();
  }
};

$("startMain").onclick = () => {
  state.weak.A = $("aWeak").value;
  state.weak.B = $("bWeak").value;
  $("inheritance").classList.add("hidden");
  $("mainGame").classList.remove("hidden");
  renderTurn();
};

$("playTurn").onclick = () => {
  if (state.finished) return;

  let aCard = $("aCard").value;
  let bCard = $("bCard").value;
  const aText = $("aText").value.trim();
  const bText = $("bText").value.trim();
  if (!aText || !bText) return alert("çŸ­æ–‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");

  aCard = normalizeCard(aCard, aText);
  bCard = normalizeCard(bCard, bText);

  let note = "";
  if (state.turn <= 3) {
    state.past.A.push(aCard);
    state.past.B.push(bCard);
  } else {
    if (!state.past.B.includes(aCard)) {
      aCard = state.past.B[0];
      note += `Aå›½ã‚«ãƒ¼ãƒ‰ã‚’ ${aCard} ã«è£œæ­£ï¼ˆå¤–äº¤ã¯ç›¸æ‰‹ã®éå»ã‚«ãƒ¼ãƒ‰ã®ã¿ï¼‰\n`;
    }
    if (!state.past.A.includes(bCard)) {
      bCard = state.past.A[0];
      note += `Bå›½ã‚«ãƒ¼ãƒ‰ã‚’ ${bCard} ã«è£œæ­£ï¼ˆå¤–äº¤ã¯ç›¸æ‰‹ã®éå»ã‚«ãƒ¼ãƒ‰ã®ã¿ï¼‰\n`;
    }
  }

  let log = note + `A:${colors[aCard]}ã€Œ${aText}ã€ / B:${colors[bCard]}ã€Œ${bText}ã€\n`;

  if (state.turn === 3 && !state.tossed) {
    state.twistTurn4 = Math.random() < 0.5;
    state.tossed = true;
    log += state.twistTurn4 ? "äº‹ä»¶: ã­ã˜ã‚Œåˆ¤å®šONï¼ˆTurn4ã®ã¿ï¼‰\n" : "äº‹ä»¶ãªã—\n";
  }

  if (aCard === bCard) {
    if (state.turn === 4 && state.twistTurn4) {
      const shifted = nextColor[aCard];
      log += `ã­ã˜ã‚Œç™ºå‹•: ${colors[aCard]}å…±é³´â†’${addScore(shifted)}`;
    } else {
      log += `å…±é³´æˆç«‹: ${addScore(aCard)}`;
    }
  } else {
    log += "ä¸å…±é³´: å¤‰åŒ–ãªã—";
  }

  $("turnLog").textContent = log;
  $("aText").value = "";
  $("bText").value = "";

  state.turn += 1;
  if (state.turn > 5) {
    state.finished = true;
    $("playTurn").disabled = true;
  }
  renderTurn();
};

$("sampleStart").onclick = () => {
  initState();
  for (let i = 0; i < 5; i += 1) {
    state.aItems.push(sampleA[i]);
    state.bItems.push(sampleB[i]);
    state.seen.add(sampleA[i]);
    state.seen.add(sampleB[i]);
  }
  state.stageIdx = 5;
  $("elimination").classList.add("hidden");
  $("inheritance").classList.remove("hidden");
  $("aWeak").value = "Y";
  $("bWeak").value = "R";
  $("elimLog").textContent = `Aå›½: ${state.aItems.join(", ")}\nBå›½: ${state.bItems.join(", ")}`;
};

$("resetAll").onclick = initState;

initState();
  </script>
</body>
</html>
